<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>বাংলা চটি ঘর</title>
  <link rel="icon" type="image/png" sizes="32x32" href="logo.png">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    body { 
      font-family: 'SolaimanLipi', Arial, sans-serif !important;
      background: black;
      }
    .header { 
      background-color: #f8f9fa; 
      padding: 0px 0px 10px 0px; 
      border-bottom: 1px solid #e9ecef; 
      border-radius: 0px 0px 15px 15px;
    }
    .logo { 
      height: 50px; 
      
    }
    .search-bar { 
      width: 100%; 
      padding: 8px; 
      border-radius: 20px; 
      border: 1px solid #ced4da;
    }
    .post-box { 
      margin-bottom: 1px; 
      border: 1px solid #e9ecef; 
      border-radius: 5px; 
      overflow: hidden;
      background: white;
    }
    .post-thumbnail { width: 100%; height: 200px; object-fit: cover; }
    .post-title { font-size: 1.5rem; margin: 15px 0; }
    .post-meta { display: flex; justify-content: space-between; align-items: center; margin-top: 15px; padding-top: 10px; border-top: 1px solid #e9ecef; }
    .footer { background-color: #343a40; color: white; padding: 30px 0; margin-top: 30px; }
    .social-icons { display: flex; justify-content: center; gap: 20px; margin-bottom: 20px; }
    .social-icon { color: white; font-size: 24px; transition: color 0.3s; }
    .social-icon:hover { color: #adb5bd; }
    .copyright { text-align: center; margin-top: 20px; font-size: 14px; color: #adb5bd; }
    .notification-bar { color: white; background: black; font-size: 16px; font-weight: 600; border-bottom: 1px solid #e0c04c; }
    .pagination { display: flex; justify-content: center; gap: 10px; flex-wrap: wrap; }
    .pagination button { border: none; padding: 8px 12px; border-radius: 4px; font-weight: bold; background-color: #f1f1f1; color: #007bff; cursor: pointer; transition: all 0.3s ease; }
    .pagination button.active { 
      background-color: #007bff; 
      color: white; 
    }
    .pagination button:hover:not(.active) { background-color: #d4e3ff; 
    }
    .notification-bar {
            color: white;
            background: black;
            font-size: 16px;
            font-weight: 600;
            border-bottom: 1px solid #e0c04c;
        }
    /* Video indicator styles */
    .post-thumbnail-container {
        position: relative;
        /*display: inline-block;*/
    }
    
    .video-indicator {
        position: absolute;
        top: 10px;
        right: 10px;
        background-color: red;
        color: white;
        padding: 5px 10px;
        border-radius: 4px;
        font-size: 14px;
        font-weight: bold;
    }
    /* Popup Modal Styles */
.popup-overlay {
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background-color: rgba(0, 0, 0, 0.7);
  z-index: 9999;
  display: flex;
  justify-content: center;
  align-items: center;
  opacity: 0;
  visibility: hidden;
  transition: all 0.3s ease;
}

.popup-overlay.active {
  opacity: 1;
  visibility: visible;
}

.popup-content {
  background-color: white;
  border-radius: 10px;
  width: 90%;
  max-width: 500px;
  max-height: 80vh;
  overflow: hidden;
  position: relative;
}

.popup-header {
  padding: 15px;
  background-color: #f8f9fa;
  border-bottom: 1px solid #dee2e6;
  display: flex;
  justify-content: space-between;
  align-items: center;
}

.popup-title {
  margin: 0;
  font-size: 1.2rem;
  font-weight: bold;
}

.popup-close {
  background: none;
  border: none;
  font-size: 1.5rem;
  cursor: pointer;
  padding: 0 5px;
}

.popup-body {
  padding: 15px;
  overflow-y: auto;
  max-height: calc(70vh - 120px);
}

.popup-footer {
  padding: 15px;
  border-top: 1px solid #dee2e6;
  text-align: center;
}

.popup-button {
  padding: 8px 20px;
  background-color: #0d6efd;
  color: white;
  border: none;
  border-radius: 5px;
  cursor: pointer;
  text-decoration: none;
  display: inline-block;
}

.popup-button:hover {
  background-color: #0b5ed7;
}
  </style>
</head>
<body>
<div class="notification-bar">
  <marquee behavior="scroll" direction="left" scrollamount="5" id="notificationMarquee">
    লোড হচ্ছে...
  </marquee>
</div>

<header class="header">
  <div class="container">
    <div class="row align-items-center">
      <div class="col-md-3">
        <img src="logo.png" alt="Website Logo" class="logo">  <!--  এখানে logo যোগ হবে-->
      </div>
      <div class="col-md-9">
        <div class="d-flex justify-content-end mb-2">
          <nav class="nav">
            <a class="nav-link" href="about.html">About</a>
            <a class="nav-link" href="contact.html">Contact Us</a>
          </nav>
        </div>
        <div class="d-flex justify-content-end">
          <input type="text" class="search-bar" placeholder="Search posts..." id="searchInput">
        </div>
      </div>
    </div>
  </div>
</header>

<div class="container my-3">
  <div class="row mb-4">
  <div class="col-12">
    <div class="ad-container" id="homeAdContainer" style="background-color: #f8f9fa; padding: 15px; border-radius: 8px; margin-bottom: 20px;">
      <!-- Ads will be loaded here -->
    </div>
  </div>
</div>
  <div class="row" id="postsContainer"></div>
  <div class="pagination my-4" id="paginationControls"></div>
</div>

<footer class="footer">
  <div class="container">
    <div class="social-icons" id="socialLinks"></div>
    <div class="copyright">
      &copy; <span id="currentYear"></span> BD choti Ghar. All rights reserved.
    </div>
  </div>
</footer>

<!-- Popup Modal -->
<div class="popup-overlay" id="popupOverlay">
  <div class="popup-content">
    <div class="popup-header">
      <h3 class="popup-title" id="popupTitle"></h3>
      <button class="popup-close" id="popupClose">&times;</button>
    </div>
    <div class="popup-body">
      <p id="popupMessage"></p>
    </div>
    <div class="popup-footer">
      <a href="#" class="popup-button" id="popupButton" target="_blank"></a>
    </div>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-database-compat.js"></script>
<script>
//firebase config হবে এখানে 
const firebaseConfig = {
  apiKey: "AIzaSyDdHzg8bJfYqLcBdWQ4ISoFTSLYeGewq-Q",
  authDomain: "bdchotighar.firebaseapp.com",
  databaseURL: "https://bdchotighar-default-rtdb.firebaseio.com",
  projectId: "bdchotighar",
  storageBucket: "bdchotighar.firebasestorage.app",
  messagingSenderId: "912869787682",
  appId: "1:912869787682:web:4bde86333a8251df34e27b",
  measurementId: "G-4YJ097ZKR4"
};

firebase.initializeApp(firebaseConfig);
const database = firebase.database();
const postsContainer = document.getElementById('postsContainer');
const searchInput = document.getElementById('searchInput');
const socialLinksContainer = document.getElementById('socialLinks');
const paginationControls = document.getElementById('paginationControls');
const currentYearSpan = document.getElementById('currentYear');
currentYearSpan.textContent = new Date().getFullYear();

let currentPage = 1;
const postsPerPage = 10; //এক পেজে পোস্ট সংখ্যা এড হবে এখানে
let allPosts = [];

function renderPaginationButtons(totalPages) {
  paginationControls.innerHTML = '';

  const firstBtn = document.createElement('button');
  firstBtn.textContent = 'First';
  firstBtn.disabled = currentPage === 1;
  firstBtn.addEventListener('click', () => {
    currentPage = 1;
    paginatePosts(allPosts, currentPage);
  });
  paginationControls.appendChild(firstBtn);

  for (let i = 1; i <= totalPages; i++) {
    const btn = document.createElement('button');
    btn.textContent = i;
    if (i === currentPage) btn.classList.add('active');
    btn.addEventListener('click', () => {
      currentPage = i;
      paginatePosts(allPosts, currentPage);
    });
    paginationControls.appendChild(btn);
  }

  const lastBtn = document.createElement('button');
  lastBtn.textContent = 'Last';
  lastBtn.disabled = currentPage === totalPages;
  lastBtn.addEventListener('click', () => {
    currentPage = totalPages;
    paginatePosts(allPosts, currentPage);
  });
  paginationControls.appendChild(lastBtn);
}

function paginatePosts(posts, page = 1) {
  postsContainer.innerHTML = '';
  const start = (page - 1) * postsPerPage;
  const end = start + postsPerPage;
  const pagePosts = posts.slice(start, end);

  pagePosts.forEach(([postId, post]) => {
    const postElement = document.createElement('div');
    postElement.className = 'col-md-6 mb-4';
    
    // Check if post has video
    const hasVideo = post.videoUrl && post.videoUrl.trim() !== '';
    
    postElement.innerHTML = `
      <div class="post-box p-3">
        <div class="post-thumbnail-container">
          <img src="${post.thumbnail}" alt="Post Thumbnail" class="post-thumbnail">
          ${hasVideo ? '<div class="video-indicator">Video</div>' : ''}
        </div>
        <h3 class="post-title">${post.title}</h3>
        <p class="post-description">${post.shortDescription}</p>
        <a href="post-details.html?id=${postId}" class="btn btn-primary read-more">আরো পড়ুন</a>
        <div class="post-meta">
          <div class="post-date">${new Date(post.timestamp).toLocaleString()}</div>
        </div>
      </div>`;
    postsContainer.appendChild(postElement);
  });

  const totalPages = Math.ceil(posts.length / postsPerPage);
  renderPaginationButtons(totalPages);
}

function loadPosts(searchTerm = '') {
  database.ref('posts').once('value', (snapshot) => {
    const posts = snapshot.val();
    if (!posts) {
      postsContainer.innerHTML = '<p>কোনো পোস্ট পাওয়া যায়নি।</p>';
      return;
    }

    const filtered = Object.entries(posts)
      .reverse()
      .filter(([_, post]) => post.title.toLowerCase().includes(searchTerm.toLowerCase()));

    allPosts = filtered;
    currentPage = 1;
    paginatePosts(allPosts, currentPage);
  });
}

searchInput.addEventListener('input', (e) => {
  loadPosts(e.target.value);
});

function loadSocialLinks() {
  database.ref('socialLinks').once('value', (snapshot) => {
    const socialLinks = snapshot.val();
    if (socialLinks) {
      socialLinksContainer.innerHTML = '';
      if (socialLinks.facebook)
        socialLinksContainer.innerHTML += `<a href="${socialLinks.facebook}" target="_blank" class="social-icon"><i class="fab fa-facebook"></i></a>`;
      if (socialLinks.instagram)
        socialLinksContainer.innerHTML += `<a href="${socialLinks.instagram}" target="_blank" class="social-icon"><i class="fab fa-instagram"></i></a>`;
      if (socialLinks.telegram)
        socialLinksContainer.innerHTML += `<a href="${socialLinks.telegram}" target="_blank" class="social-icon"><i class="fab fa-telegram"></i></a>`;
      if (socialLinks.whatsapp)
        socialLinksContainer.innerHTML += `<a href="${socialLinks.whatsapp}" target="_blank" class="social-icon"><i class="fab fa-whatsapp"></i></a>`;
    }
  });
}

function setupRealtimeNotification() {
  const notificationMarquee = document.getElementById('notificationMarquee');
  if (!notificationMarquee) return;
  firebase.database().ref('notifications/latest').on('value', (snapshot) => {
    const notification = snapshot.val();
    if (notification && notification.text) {
      notificationMarquee.textContent = notification.text;
    } else {
      notificationMarquee.textContent = 'কোনো নোটিফিকেশন নেই';
    }
  });
}

// Popup Message Functionality
function loadPopupMessage() {
  database.ref('popupMessage').once('value', (snapshot) => {
    const popupData = snapshot.val();
    if (popupData && popupData.enabled) {
      const popupOverlay = document.getElementById('popupOverlay');
      const popupTitle = document.getElementById('popupTitle');
      const popupMessage = document.getElementById('popupMessage');
      const popupButton = document.getElementById('popupButton');
      const popupClose = document.getElementById('popupClose');
      
      popupTitle.textContent = popupData.title || 'নোটিশ';
      popupMessage.textContent = popupData.message || '';
      
      if (popupData.buttonText && popupData.buttonLink) {
        popupButton.textContent = popupData.buttonText;
        popupButton.href = popupData.buttonLink;
        popupButton.style.display = 'inline-block';
      } else {
        popupButton.style.display = 'none';
      }
      
      popupOverlay.classList.add('active');
      
      popupClose.addEventListener('click', () => {
        popupOverlay.classList.remove('active');
      });
    }
  });
}

// ভিজিট ট্র্যাক করুন
function trackVisit(postId = null) {
  const today = new Date().toISOString().split('T')[0];
  const updates = {};
  
  // টোটাল ভিজিট
  updates['visitorStats/totalVisits'] = firebase.database.ServerValue.increment(1);
  
  // ডেইলি ভিজিট
  updates[`visitorStats/dailyVisits/${today}`] = firebase.database.ServerValue.increment(1);
  
  // পোস্ট ভিজিট (যদি পোস্ট আইডি থাকে)
  if (postId) {
    updates[`visitorStats/postVisits/${postId}`] = firebase.database.ServerValue.increment(1);
  }
  
  // সর্বশেষ আপডেট টাইম
  updates['visitorStats/lastUpdated'] = new Date().toISOString();
  
  // সব আপডেট একসাথে করুন
  firebase.database().ref().update(updates);
}

// ইনডেক্স পেজে কল করুন (index.html)
trackVisit();

  function trackPageVisit(pageName) {
    const today = new Date().toISOString().split('T')[0];
    const updates = {};
    
    // টোটাল ভিজিট
    updates['visitorStats/totalVisits'] = firebase.database.ServerValue.increment(1);
    
    // ডেইলি ভিজিট
    updates[`visitorStats/dailyVisits/${today}`] = firebase.database.ServerValue.increment(1);
    
    // পেজ ভিজিট (স্ট্যাটিক পেজের জন্য)
    updates[`visitorStats/pageVisits/${pageName}`] = firebase.database.ServerValue.increment(1);
    
    // সর্বশেষ আপডেট টাইম
    updates['visitorStats/lastUpdated'] = new Date().toISOString();
    
    // সব আপডেট একসাথে করুন
    firebase.database().ref().update(updates);
  }
  
  
  
  
    // Load and display ads
  function loadAndDisplayAds() {
    const adContainer = document.getElementById('homeAdContainer');
    database.ref('ads').once('value', (snapshot) => {
      const ads = snapshot.val();
      
      if (ads) {
        // Filter ads that should appear on home page
        const homeAds = Object.entries(ads).filter(([_, ad]) =>
          ad.position === 'both' || ad.position === 'home'
        );
        
        if (homeAds.length > 0) {
          // Select a random ad
          const randomAd = homeAds[Math.floor(Math.random() * homeAds.length)][1];
          
          // Create ad HTML
          let adHtml = '';
          if (randomAd.type === 'video') {
            adHtml = `
            <a href="${randomAd.link}" target="_blank" style="display: block;">
              <video autoplay loop muted playsinline style="width: 100%; max-height: 300px; border-radius: 5px;">
                <source src="${randomAd.image}" type="video/mp4">
              </video>
            </a>
          `;
          } else {
            adHtml = `
            <a href="${randomAd.link}" target="_blank" style="display: block;">
              <img src="${randomAd.image}" style="width: 100%; max-height: 300px; object-fit: contain; border-radius: 5px;">
            </a>
          `;
          }
          
          adContainer.innerHTML = adHtml;
        } else {
          adContainer.innerHTML = '<p class="text-center">Advertisement</p>';
        }
      } else {
        adContainer.innerHTML = '<p class="text-center">Advertisement</p>';
      }
    });
  }
  
  // পেজ অনুযায়ী ট্র্যাকিং কল করুন
  // index.html এ:
trackPageVisit('main');
loadPosts();
loadSocialLinks();
setupRealtimeNotification();
loadPopupMessage();
loadAndDisplayAds();
</script>
</body>
</html>