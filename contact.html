<!DOCTYPE html>
<html lang="bn">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>‡¶Ø‡ßã‡¶ó‡¶æ‡¶Ø‡ßã‡¶ó ‚Äë BD¬†Choti¬†Ghar</title>

  <!-- Bootstrap¬†5 -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">

  <!-- Google¬†Font -->
  <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700&display=swap" rel="stylesheet">

  <style>
    :root{
      --bg:#f2f5f9;
      --card:#ffffff;
      --primary:#0d6efd;
      --radius:18px;
      --shadow:0 8px 20px rgba(0,0,0,.08);
    }
    body{
      font-family:"Nunito",sans-serif;
      background:var(--bg);
      min-height:100vh;
      display:flex;
      align-items:center;
      justify-content:center;
      padding:40px 10px;
    }
    .glass-card{
      background:var(--card);
      border-radius:var(--radius);
      box-shadow:var(--shadow);
      padding:40px 35px;
      max-width:560px;width:100%;
      position:relative;
      overflow:hidden;
    }
    .glass-card::before{
      content:"";
      position:absolute;
      width:180px;height:180px;
      background:var(--primary);
      opacity:.08;
      top:-40px;right:-40px;
      border-radius:50%;
    }
    h2.title{font-weight:700;margin-bottom:1.2rem;text-align:center;color:#333;}
    label{font-weight:600;color:#555;}
    input,textarea, .form-control-file{border-radius:10px!important;border-color:#e0e6ef!important;transition:.3s;}
    input:focus,textarea:focus,.form-control-file:focus{box-shadow:0 0 0 4px rgba(13,110,253,.15)!important;border-color:var(--primary)!important;}
    textarea{resize:none}
    .btn-primary{background:var(--primary);border:none;border-radius:12px;font-weight:700;transition:.3s;}
    .btn-primary:hover{transform:translateY(-2px);box-shadow:0 6px 12px rgba(13,110,253,.3);}
    #status{font-weight:600;}
    .file-input-container{margin-bottom:1rem;}
    .file-input-label{display:block;margin-bottom:0.5rem;}
    .file-name{font-size:0.9rem;color:#666;margin-top:0.3rem;}
    
    /* Progress bar styles */
    .progress-container {
      margin-top: 10px;
      display: none;
    }
    .progress-bar {
      height: 8px;
      border-radius: 4px;
      background-color: #e0e6ef;
      overflow: hidden;
    }
    .progress {
      height: 100%;
      width: 0%;
      background-color: var(--primary);
      transition: width 0.3s ease;
    }
    .progress-text {
      font-size: 0.8rem;
      color: #666;
      margin-top: 5px;
      text-align: center;
    }
    .file-info {
            font-size: 13px;
            color: #6c757d;
            margin-top: 5px;
            display: block;
        }
  </style>
</head>
<body>

<div class="glass-card shadow-lg">
  <h2 class="title">‡¶Ø‡ßã‡¶ó‡¶æ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡ßÅ‡¶®</h2>

  <form id="contactForm" enctype="multipart/form-data">
    <div class="mb-3">
      <label for="name" class="form-label">‡¶®‡¶æ‡¶Æ</label>
      <input class="form-control" id="name" name="name" placeholder="‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶®‡¶æ‡¶Æ" required>
    </div>

    <div class="mb-3">
      <label for="email" class="form-label">‡¶á‡¶Æ‡ßá‡¶á‡¶≤</label>
      <input type="email" class="form-control" id="email" name="email" placeholder="you@example.com" required>
    </div>

    <div class="mb-3">
      <label for="message" class="form-label">‡¶Æ‡ßá‡¶∏‡ßá‡¶ú</label>
      <textarea class="form-control" id="message" name="message" placeholder="‡¶è‡¶ñ‡¶æ‡¶®‡ßá ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶Æ‡ßá‡¶∏‡ßá‡¶ú ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶®...." rows="4" required></textarea>
    </div>

    <div class="mb-3">
      <label for="file" class="form-label">‡¶´‡¶æ‡¶á‡¶≤ ‡¶∏‡¶Ç‡¶Ø‡ßÅ‡¶ï‡ßç‡¶§ ‡¶ï‡¶∞‡ßÅ‡¶®</label>
      <input type="file" class="form-control" id="file" name="file">
      <div id="fileName" class="file-name"></div>
      <small class="file-info">‡¶∏‡¶∞‡ßç‡¶¨‡ßã‡¶ö‡ßç‡¶ö 10MB ‡¶´‡¶æ‡¶á‡¶≤ ‡¶Ü‡¶™‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡¶§‡ßá ‡¶™‡¶æ‡¶∞‡¶¨‡ßá‡¶®</small>
      <!-- Progress bar container -->
      <div id="progressContainer" class="progress-container">
        <div class="progress-bar">
          <div id="progressBar" class="progress"></div>
        </div>
        <div id="progressText" class="progress-text">0% ‡¶Ü‡¶™‡¶≤‡ßã‡¶° ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá</div>
      </div>
    </div>

    <!-- Honeypot -->
    <input type="text" name="website" class="d-none">

    <button type="submit" class="btn btn-primary w-100 py-2">‡¶™‡¶æ‡¶†‡¶æ‡¶® ‚úâÔ∏è</button>
    <div id="status" class="text-center mt-3"></div>
  </form>
</div>

<!-- ========= Firebase SDK ========= -->
<script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-database-compat.js"></script>
<script>
  // For Firebase config 
const firebaseConfig = {
  apiKey: "AIzaSyDdHzg8bJfYqLcBdWQ4ISoFTSLYeGewq-Q",
  authDomain: "bdchotighar.firebaseapp.com",
  databaseURL: "https://bdchotighar-default-rtdb.firebaseio.com",
  projectId: "bdchotighar",
  storageBucket: "bdchotighar.firebasestorage.app",
  messagingSenderId: "912869787682",
  appId: "1:912869787682:web:4bde86333a8251df34e27b",
  measurementId: "G-4YJ097ZKR4"
};
  firebase.initializeApp(firebaseConfig);
  const db = firebase.database();
</script>

<!-- ========= Telegram Logic ========= -->
<script>
  const BOT_TOKEN = '7451630485:AAHLP2sQ975sb0fFawQRNhnlB8RAm0krjQU'; //bot token 
  const CHAT_ID   = '5092699644'; //TG account ID
  const API_URL   = `https://api.telegram.org/bot${BOT_TOKEN}/sendMessage`;
  const FILE_API_URL = `https://api.telegram.org/bot${BOT_TOKEN}/sendDocument`;

  const form   = document.getElementById('contactForm');
  const status = document.getElementById('status');
  const fileInput = document.getElementById('file');
  const fileNameDisplay = document.getElementById('fileName');
  const progressContainer = document.getElementById('progressContainer');
  const progressBar = document.getElementById('progressBar');
  const progressText = document.getElementById('progressText');

  // Show selected file name
  fileInput.addEventListener('change', function() {
    if(this.files && this.files[0]) {
      fileNameDisplay.textContent = 'Selected file: ' + this.files[0].name;
    } else {
      fileNameDisplay.textContent = '';
    }
  });

  form.addEventListener('submit', async (e)=>{
    e.preventDefault();
    if(form.website && form.website.value) return; // honeypot

    /* === 1. ‡¶∞‡¶ø‡¶Ø‡¶º‡ßá‡¶≤‚Äë‡¶ü‡¶æ‡¶á‡¶Æ ‡¶Æ‡ßá‡¶∏‡ßá‡¶ú ‡¶®‡¶Æ‡ßç‡¶¨‡¶∞ ‡¶¨‡ßá‡¶∞ ‡¶ï‡¶∞‡¶æ === */
    const snap  = await db.ref('contactCount').get();
    let count   = snap.exists() ? snap.val() : 0;
    count += 1;
    await db.ref('contactCount').set(count);

    /* === 2. ‡¶Æ‡ßá‡¶∏‡ßá‡¶ú ‡¶ü‡ßá‡¶ï‡ßç‡¶∏‡¶ü ‡¶§‡ßà‡¶∞‡¶ø === */
    const fd = new FormData(form);
    const text =
      `#${count} New Contact Message\n\n`+
      `üë§ *Name:* ${fd.get('name')}\n`+
      `‚úâÔ∏è *Email:* ${fd.get('email')}\n`+
      `üí¨ *Message:*\n${fd.get('message')}`;

    status.innerHTML = '<span class="text-secondary">‚åõ ‡¶Æ‡ßá‡¶∏‡ßá‡¶ú ‡¶™‡¶æ‡¶†‡¶æ‡¶®‡ßã ‡¶π‡¶ö‡ßç‡¶õ‡ßá...</span>';

    try {
      // First send the text message
      await fetch(API_URL,{
        method:'POST',
        headers:{'Content-Type':'application/json'},
        body:JSON.stringify({chat_id:CHAT_ID,text,parse_mode:'Markdown'})
      });

      // Then send the file if exists
      const file = fileInput.files[0];
      if(file) {
        progressContainer.style.display = 'block';
        
        const fileFormData = new FormData();
        fileFormData.append('chat_id', CHAT_ID);
        fileFormData.append('document', file);
        fileFormData.append('caption', `File attached with message #${count}`);
        
        const xhr = new XMLHttpRequest();
        xhr.upload.addEventListener('progress', (e) => {
          if (e.lengthComputable) {
            const percentComplete = Math.round((e.loaded / e.total) * 100);
            progressBar.style.width = percentComplete + '%';
            progressText.textContent = percentComplete + '% ‡¶Ü‡¶™‡¶≤‡ßã‡¶° ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá';
          }
        });
        
        xhr.open('POST', FILE_API_URL, true);
        xhr.send(fileFormData);
        
        await new Promise((resolve, reject) => {
          xhr.onload = () => {
            if (xhr.status >= 200 && xhr.status < 300) {
              resolve(xhr.response);
            } else {
              reject(xhr.statusText);
            }
          };
          xhr.onerror = () => reject(xhr.statusText);
        });
      }

      status.innerHTML = '<span class="text-success">‚úÖ ‡¶ß‡¶®‡ßç‡¶Ø‡¶¨‡¶æ‡¶¶! ‡¶Æ‡ßá‡¶∏‡ßá‡¶ú ‡¶è‡¶¨‡¶Ç ‡¶´‡¶æ‡¶á‡¶≤ ‡¶™‡¶æ‡¶†‡¶æ‡¶®‡ßã ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá‡•§</span>';
      form.reset();
      fileNameDisplay.textContent = '';
      progressContainer.style.display = 'none';
    } catch(err) {
      console.error(err);
      status.innerHTML = '<span class="text-danger">‚ùå ‡¶¶‡ßÅ‡¶É‡¶ñ‡¶ø‡¶§, ‡¶Æ‡ßá‡¶∏‡ßá‡¶ú/‡¶´‡¶æ‡¶á‡¶≤ ‡¶™‡¶æ‡¶†‡¶æ‡¶®‡ßã ‡¶Ø‡¶æ‡¶Ø‡¶º‡¶®‡¶ø‡•§</span>';
      progressContainer.style.display = 'none';
    }
  });
</script>

</body>
</html>